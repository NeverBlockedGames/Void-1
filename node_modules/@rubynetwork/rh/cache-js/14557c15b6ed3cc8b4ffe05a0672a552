/*hammerhead|script|start*/"use strict";if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3391],{32398:function(e,t,r){r.d(t,{t:function(){return y}});var n=r(88157),a=r(27042),s=r(9973),o=r(45001),i=r(38982),u=r(78520),c=r(3132),l=r(52547),f=r(52694),d=r(40443),h=r(2173),p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t= __get$(arguments,r) )Object.prototype.hasOwnProperty.call(t,a)&&( __set$(e,a,__get$(t,a)) );return e}).apply(this,arguments)},v=function(e,t){var r,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&( __set$(s,Symbol.iterator,function(){return this;}) ),s;function i(i){return function(u){return function(i){if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&& __get$(a,a.length-1) )&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},S="authServiceHost",g="ncmHost",b=new AbortController().signal;function m(e,t){var r=this;return function(m,y){var w,A,E;return w=void 0,A=void 0,E=function(){var r,w,A,E,k,P,Z,T,I,x,N,U,F,M,O,L;return v(this,function(v){switch(v.label){case 0:r="",w="",A=null,v.label=1;case 1:if(v.trys.push([1,15,,16]),E= new URL(t.host===S||t.host===g?t.path:"/oapi".concat(c.ZP.prefix||"").concat(t.path),(t.host===S&&!c.ZP.authUseThirdPartyFlow)&&"https://".concat(c.ZP.appInfo.authServiceHost)?"https://".concat(c.ZP.appInfo.authServiceHost):t.host===g?c.ZP.ngNcmHost:__get$(window,"location").origin) ,m&&(E.search=new URLSearchParams(m).toString()),k=(0,o.qX)(),P=localStorage.getItem(a.B1h),Z={"x-ngg-playuser-token":""},P&&(Z.Authorization="NowV2 ".concat(P),Z["x-ngg-playuser-token"]=k),!t.firebaseAuth)return[3,3];return[4,null===(O=(T=(0,l.v0)()).currentUser)||void 0===O?void 0:O.getIdToken()];case 2:if(!(I=v.sent()))return[2,{status:T.currentUser?s.ch.FailureInvalidFirebaseToken:s.ch.FirebaseInitFailed,errorData:I}];Z.firebaseAuthorization="Bearer ".concat(I),v.label=3;case 3:if(x=t.authorize&&(Z.Authorization||Z.firebaseAuthorization)?{headers:Z}:{},w=E.toString(),N=t.avoidAbortSignal?void 0:b,"GET"!==e)return[3,5];return[4,fetch(w,{credentials:t.host===g?"omit":"include",headers:p({"x-ngg-fe-version":n.f4,"x-ngg-skip-evar-check":t.skipEvarCheck?t.skipEvarCheck:"true"},x.headers),signal:N})];case 4:case 6:return A=v.sent(),[3,9];case 5:if("PATCH"!==e)return[3,7];return[4,fetch(w,{method:"PATCH",credentials:"include",headers:p({"content-type":"application/json","x-ngg-fe-version":n.f4},null==x?void 0:x.headers),body:y?JSON.stringify(y):void 0})];case 7:return[4,fetch(w,{method:"POST",credentials:"include",headers:p({"content-type":"application/json","x-ngg-fe-version":n.f4,"x-ngg-skip-evar-check":t.skipEvarCheck?t.skipEvarCheck:"true"},null==x?void 0:x.headers),body:y?JSON.stringify(y):void 0})];case 8:A=v.sent(),v.label=9;case 9:if(409===A.status&&u.Z.dispatch({type:i.Z.SET_ERROR,payload:{error:s.YR.FailureValidationError,clientId:"",sessionId:"",isAndroidConnected:!1,errorDescription:""}}),205!==A.status)return[3,11];return window.nggVersionMismatch=!0,[4,(0,o.gw)(1e4)];case 10:throw v.sent(),(0,f.iI)("StartSession"),Error("Version Mismatch");case 11:return[4,A.text()];case 12:if((U=JSON.parse(r=v.sent())).status&& __get$(a.VI_,U.status) &&(0,d.Z)( __get$(a.VI_,U.status) ,"","NowggIfpSdkEvent"),401!==A.status)return[3,14];return[4,(0,h.Zb)(e,t,m,y,U.status,A.url,JSON.stringify("json"))];case 13:if(F=v.sent())return[2,F];return[2,U];case 14:if(!A.ok)return(0,n.ZP)(Error("fetch: ".concat(w," failed, response.ok: ").concat(A.ok)),{response:A}),[2,{status:s.YR.FailureUnexpectedHttpStatusCode,errorMessage:"Http Status Code ".concat(A.status,", JSON Status: ").concat(null==U?void 0:U.status,", JSON Message: ").concat(null==U?void 0:U.errorMessage),errorData:U}];if(!t.host&&U.status===s.YR.FailureUnauthorized)return(0,h.kS)({reason:"StatusFailureUnauthorized",url:null===(L=null==A?void 0:A.url)||void 0===L?void 0:L.split("?")[0]}),[2,{status:s.YR.JsonStatusFailureUnauthorized,errorMessage:"Http Status Code 401"}];if(!U||!(U.status||"boolean"==typeof U.success))return[2,{status:s.YR.FailureMalformedJSONResponse,errorMessage:"JSON Status ".concat(A.status)}];return[2,U];case 15:return"AbortError"!==(M=v.sent()).name&&(0,n.ZP)("Firebase Api Failed: ".concat(M.message),{error:{e:M,type:"".concat(M.name),message:"".concat(M.message),path:"".concat(e," ").concat(t.path),finalUrl:w,responseText:r},response:A,requestData:{query:m,body:y,options:t,method:e},appState:{ngNcmHost:c.ZP.ngNcmHost,authUseThirdPartyFlow:c.ZP.authUseThirdPartyFlow,prefix:c.ZP.prefix}}),[2,{status:s.YR.FailureFeFetchException,errorMessage:"".concat(M.name,": ").concat(M.message),errorStack:M.stack}];case 16:return[2]}})},new(A||(A=Promise))(function(e,t){function n(e){try{s(E.next(e))}catch(e){t(e)}}function a(e){try{s(E.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):((r=t.value)instanceof A?r:new A(function(e){e(r)})).then(n,a)}s((E=E.apply(r,w||[])).next())})}}var y={startLiveStream:m("POST",{host:null,path:"/lstrm/v1/startLiveStream",authorize:!0,firebaseAuth:!0}),getViewLiveStreamInfo:m("GET",{host:null,path:"/lstrm/v1/viewLiveStream",authorize:!0,firebaseAuth:!0}),getAvailableLiveStream:m("GET",{host:null,path:"/lstrm/v1/pickLiveStream",authorize:!0,firebaseAuth:!0}),getLiveStreamInfo:m("GET",{host:null,path:"/lstrm/v1/getLiveStreamInfo",authorize:!0,firebaseAuth:!0}),stopLiveStream:m("POST",{host:null,path:"/lstrm/v1/stopLiveStream",authorize:!0,firebaseAuth:!0}),sendLiveStreamMessage:m("POST",{host:null,path:"/lstrm/v1/sendLiveStreamMessage",authorize:!0,firebaseAuth:!0})};t.Z=y},53391:function(e,t,r){r.r(t),r.d(t,{connectToFirestore:function(){return m},sendMessage:function(){return y},unSubscribeOldFirebaseSnapshot:function(){return g}});var n,a,s,o,i=r(90109),u=r(78520),c=r(47444),l=r(83452),f=r(3132),d=r(2173),h=r(32398),p=r(89355),v=function(e,t,r,n){return new(r||(r=Promise))(function(a,s){function o(e){try{u(n.next(e))}catch(e){s(e)}}function i(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,i)}u((n=n.apply(e,t||[])).next())})},S=function(e,t){var r,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&( __set$(s,Symbol.iterator,function(){return this;}) ),s;function i(i){return function(u){return function(i){if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&& __get$(a,a.length-1) )&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},g=function(){return v(void 0,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:if(n&&n(),a&&a(),s&&s(),!o)return[3,2];return[4,o()];case 1:e.sent(),e.label=2;case 2:return[2]}})})},b=!0,m=function(e,t,r){return v(void 0,void 0,void 0,function(){var f,d,h,y;return S(this,function(w){switch(w.label){case 0:if(!(f=u.Z.getState().streaming.firestoreDb))return[2];return b=!1,u.Z.dispatch({type:c.Z.SET_FIREBASE_AUTH_TOKEN,payload:{documentId:t,collectionId:e}}),[4,g()];case 1:if(w.sent(),d=function(e){return v(void 0,void 0,void 0,function(){var t,r,n,a,s,o,i,c;return S(this,function(l){switch(l.label){case 0:if(l.trys.push([0,4,,5]),n=(r=u.Z.getState().streaming).firebaseUid,a=r.firebaseDb,s={state:"Active",lastStateUpdatedAtMs:(0,p.Bt)()},o={state:"Inactive",lastStateUpdatedAtMs:(0,p.Bt)()},!(a&&n&&e))return[3,3];return i=(0,p.iH)(a,"LiveStreams/".concat(e,"/Viewers/").concat(n)),[4,(0,p.t8)(i,s)];case 1:return l.sent(),c=(0,p.ae)(i),t=function(){return v(void 0,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return[4,Promise.all([(0,p.t8)(i,o),c.cancel()])];case 1:return e.sent(),[2]}})})},[4,c.set(o)];case 2:l.sent(),l.label=3;case 3:return[2,t];case 4:return l.sent(),[2,t];case 5:return[2]}})})},h=(0,i.IO)((0,i.hJ)(f,"".concat(e||"","/").concat(t||"","/Viewers"))),n=(0,i.cf)(h,function(e){b=!0;var t=[];e.forEach(function(e){var r=e.data();r&&"Active"===r.state&&t.push(e.id)}),u.Z.dispatch({type:c.Z.UPDATE_VIEWERS,payload:{viewers:t||[]}})},function(){b&&setTimeout(function(){m(e||"",t||"",r)},1e3)}),y=(0,i.IO)((0,i.hJ)(f,"".concat(e||"","/").concat(t||"","/Messages"))),a=(0,i.cf)(y,function(e){b=!0;var t=[];e.forEach(function(e){var r=e.data();r&&t.push(r)}),u.Z.dispatch({type:c.Z.UPDATE_MESSAGES,payload:{messages:t.sort(function(e,t){return e.createdAt>t.createdAt?1:-1})||[]}})},function(n){b&&setTimeout(function(){m(e||"",t||"",r)},2e3)}),s=(0,i.cf)((0,i.JU)(f,"".concat(e||"","/").concat(t||"")),function(e){b=!0;var t,r,n=e.data(),a={userHandle:n.userHandle,userNickname:n.userNickname,userAvatar:n.userAvatar,isPaused:((null===(t=n.pausedAt)||void 0===t?void 0:t.seconds)||0)>((null===(r=n.resumedAt)||void 0===r?void 0:r.seconds)||0),appName:n.appName,isStopped:"Inactive"===n.state,appId:n.appId};if(a.isStopped)g(),u.Z.dispatch({type:c.Z.UPDATE_MESSAGES,payload:{streamViewingActive:!1,streamerState:l.W.Paused}});else{var s=u.Z.getState().streaming.streamerState,o=s===l.W.Paused,i=s;(null==a?void 0:a.isPaused)?i=l.W.Paused:o&&(i=l.W.None),u.Z.dispatch({type:c.Z.UPDATE_MESSAGES,payload:{streamerState:i}})}u.Z.dispatch({type:c.Z.UPDATE_MESSAGES,payload:{streamInfo:a}})},function(n){b&&setTimeout(function(){m(e||"",t||"",r)},1e3)}),!r)return[3,3];return[4,d(t)];case 2:o=w.sent(),w.label=3;case 3:return[2]}})})},y=function(e){return v(void 0,void 0,void 0,function(){var t,r,n;return S(this,function(a){return u.Z.getState().auth.isLoggedIn&&(0,d.et)(),t=u.Z.getState().streaming.firestoreDb,r=u.Z.getState().streaming.documentId,n=u.Z.getState().streaming.streamerState,!t||n!==l.W.None&&n!==l.W.Paused&&f.ZP.isStreamPage||h.Z.sendLiveStreamMessage({},{lstrmId:r,text:e}),[2]})})}}}]);

/*hammerhead|script|end*/