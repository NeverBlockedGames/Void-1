/*hammerhead|script|start*/if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
window.adsControllerLoaded = true;
let adsVisible = false;

if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    container.className = "unity-mobile";
    // Avoid draining fillrate performance on mobile devices,
    // and default/override low DPI mode on mobile browsers.
    config.devicePixelRatio = 1;
    mobileWarning.style.display = "block";
    setTimeout(() => {
        mobileWarning.style.display = "none";
    }, 5000);
}

document.onkeydown = function (e) {
    if (e.altKey || e.ctrlKey || e.key === "F1" || e.key === "F2" || e.key === "F3" || e.key === "F4") {
        e.preventDefault();
    }
}

document.onmouseup = function (e) {
    e.preventDefault();
}

document.addEventListener('pointerlockchange', lockChangeAlert, false);
document.addEventListener('mozpointerlockchange', lockChangeAlert, false);

let lockedOccured = false;
function lockChangeAlert() {
    if (!lockedOccured && document.pointerLockElement)
        lockedOccured = true;
    if (!document.pointerLockElement && lockedOccured){
        lockedOccured = false;
        window.unityInstance.SendMessage("Pause Menu", "OnCursorUnlocked");
    }
}

window.addEventListener('resize', injectAdByWindowSize);

function injectAdByWindowSize() {
    if(!window.cpmstarAPI)
        return;
    // Inject small ad if screen is small, or large ad if screen is large
    if (window.innerHeight < 900) {
        if (document.getElementById("adRectangleBottom") == null) {
            var el = document.getElementsByClassName("ad-rectangle-bottom")[0];
            el.id = "adRectangleBottom";
            cpmstarAPI({kind:'go',module:'POOL 83025', config: { conditions: { target: { el: el, kind: 'replace' }}}});
        }
    }
    else {
        if (document.getElementById("adLeaderboardBottom") == null) {
            var el = document.getElementsByClassName("ad-leaderboard-bottom")[0];
            el.id = "adLeaderboardBottom";
            cpmstarAPI({kind:'go',module:'POOL 85420', config: { conditions: { target: { el: el, kind: 'replace' }}}});
        }
    }
}

injectAdByWindowSize();

var refreshNextTime = true;

async function showAds() {
    while (window.cpmstarAPI === undefined) {
        await sleep(500)
    }

    document.getElementsByClassName("ad-rectangle-bottom")[0].style.display = "block";
    document.getElementsByClassName("ad-leaderboard-bottom")[0].style.display = "block";
    document.getElementsByClassName("ad-rectangle-upper")[0].style.display = "block";

    if (typeof counter === 'undefined') {
        startCounter();
        resumeCounter();
    }
    else {
        resumeCounter();
        refresh();
    }
}

async function hideAds() {
    while (window.cpmstarAPI === undefined) {
        await sleep(500)
    }

    document.getElementsByClassName("ad-rectangle-bottom")[0].style.display = "none";
    document.getElementsByClassName("ad-leaderboard-bottom")[0].style.display = "none";
    document.getElementsByClassName("ad-rectangle-upper")[0].style.display = "none";

    pauseCounter();
}

async function refresh() {
    while (window.isWatchingRV === true) {
        await sleep(2000)
    }

    //console.log("time since ads refresh = " + timeSinceRefresh + " seconds");
    //console.log("time ads visible = " + timeAdsVisible + " seconds");

    if (timeSinceRefresh <= 30 || timeAdsVisible <= 2) {
        //console.log("don't refresh");
        return;
    }

    if (document.getElementById("adRectangleBottom") != null &&
        window.getComputedStyle(document.getElementsByClassName("ad-smallscreen")[0]).display !== "none") {
        cpmstarAPI({ kind: "adcmd", module: "POOL 83023", command: "refresh" });
    }

    if (document.getElementById("adLeaderboardBottom") != null &&
        window.getComputedStyle(document.getElementsByClassName("ad-largescreen")[0]).display !== "none") {
        cpmstarAPI({ kind: "adcmd", module: "POOL 85420", command: "refresh" });
    }

    cpmstarAPI({kind:'go',module:"POOL 83025", config: { conditions: { target: { find: '#adRectangleUpper', kind: 'replace', command: "refresh"} }}});

    timeSinceRefresh = 0;
    timeAdsVisible = 0;
    //console.log("refresh ads");
}

window.onfocus = function () {
    //console.log("onfocus");
    resumeCounter();
    refresh();
};

window.onblur = function () {
    //console.log("onblur");
    pauseCounter();
};

var timeSinceRefresh = 0;
var timeAdsVisible = 0;
var counter;

function startCounter() {
    timeSinceRefresh++;
    if (adsVisible)
        timeAdsVisible++;

    counter = setTimeout(function () {
        startCounter();
    }, 1000);
}

function resumeCounter() {
    adsVisible = true;
}

function pauseCounter() {
    adsVisible = false;
}
/*hammerhead|script|end*/